<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Payment</title>
    <!-- Include Razorpay Checkout script -->
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>
<body>
    <h1>Payment Page</h1>
    
    <div id="payment-container">
        <h2>Amount to Pay: {{ pdata.amount }}</h2>
        <h4>{{ pdata.name }}</h4>
        <h4>{{ pdata.amount }}</h4>
        <h4>{{ pdata.key }}</h4>
        
        <button id="pay-button">Pay Now</button>
    </div> 

    <script>
        // Initialize Razorpay Checkout
        var options = {
            "key": "{{ pdata.key }}",  // Your Razorpay API key
            "amount": "{{ pdata.amount }}",  // Amount to pay
            "currency": "{{ pdata.currency }}",  // Currency
            "name": "Kings of Cloud",  // Your business name
            "description": "Reservation Payment",  // Payment description
            "order_id": "{{ pdata.order_id }}",  // Order ID
            // Add other necessary options for Razorpay
            "handler": function(response) {
                // Handle success callback
                console.log(response);
                // After successful payment, call function to send payment details to server
                sendPaymentDetails();
            }
        };

        // Initialize Razorpay Checkout with options
        var rzp = new Razorpay(options);

        // Event listener for Pay Now button click
        document.getElementById('pay-button').onclick = function(e) {
            // Open Razorpay Checkout
            rzp.open();
        };

        // Function to send payment details to the server
        function sendPaymentDetails() {
            var paymentData = {
                order_id: "{{ pdata.order_id }}",
                name: "{{ pdata.name }}",
                email: "{{ pdata.email }}",
                phone: "{{ pdata.phone }}",
                person: "{{ pdata.person }}",
                amount: "{{ pdata.amount }}",
                reservation_date: "{{ pdata.reservation_date }}",
                reservation_time: "{{ pdata.reservation_time }}"
            };

            fetch('http://localhost:5000/payment_success', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(paymentData)
            })
            .then(response => {
                if (response.ok) {
                    alert("Payment details sent successfully!");
                    // Redirect or perform other actions after successful payment
                } else {
                    throw new Error('Failed to send payment details.');
                }
            })
            .catch(error => {
                console.error('Error sending payment details:', error.message);
                // Handle error accordingly
            });
        }
    </script>
</body>
</html>
